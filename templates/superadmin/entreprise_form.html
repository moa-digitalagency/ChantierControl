{% extends 'base.html' %}
{% block title %}{% if entreprise %}Modifier{% else %}Nouvelle{% endif %} Entreprise - Super Admin{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{{ url_for('superadmin.liste_entreprises') }}" class="text-purple-600 hover:text-purple-800">
        <i class="fas fa-arrow-left mr-1"></i> Retour aux entreprises
    </a>
    <h1 class="text-2xl font-bold text-purple-800 mt-2">
        <i class="fas fa-building mr-2"></i> 
        {% if entreprise %}Modifier l'entreprise{% else %}Nouvelle Entreprise{% endif %}
    </h1>
</div>

<form method="POST" class="space-y-6">
    <div class="bg-white rounded-lg shadow">
        <div class="border-b px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800">
                <i class="fas fa-info-circle mr-2 text-purple-600"></i> Informations de l'Entreprise
            </h2>
        </div>
        <div class="p-6 grid md:grid-cols-2 gap-6">
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Nom de l'entreprise *</label>
                <input type="text" name="nom" value="{{ entreprise.nom if entreprise else '' }}" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                <input type="text" name="adresse" value="{{ entreprise.adresse if entreprise else '' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
                <input type="tel" name="telephone" value="{{ entreprise.telephone if entreprise else '' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" name="email" value="{{ entreprise.email if entreprise else '' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            {% if entreprise %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Admin Principal</label>
                <select name="admin_principal_id" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <option value="">-- Sélectionner --</option>
                    {% for admin in admins %}
                    <option value="{{ admin.id }}" {% if entreprise.admin_principal_id == admin.id %}selected{% endif %}>
                        {{ admin.prenom }} {{ admin.nom }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex items-center">
                <label class="flex items-center">
                    <input type="checkbox" name="actif" {% if entreprise.actif %}checked{% endif %}
                           class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <span class="ml-2 text-sm text-gray-700">Entreprise active</span>
                </label>
            </div>
            {% endif %}
        </div>
    </div>
    
    {% if not entreprise %}
    <div class="bg-white rounded-lg shadow">
        <div class="border-b px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800">
                <i class="fas fa-user-shield mr-2 text-indigo-600"></i> Administrateur Principal
            </h2>
            <p class="text-sm text-gray-500">Créez l'administrateur qui gèrera cette entreprise</p>
        </div>
        <div class="p-6 grid md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Prénom *</label>
                <input type="text" name="admin_prenom" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
                <input type="text" name="admin_nom" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Téléphone *</label>
                <input type="tel" name="admin_telephone" required pattern="[0-9]{10}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                       placeholder="06XXXXXXXX">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Code PIN (4 chiffres) *</label>
                <input type="password" name="admin_pin" required pattern="[0-9]{4}" maxlength="4"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                       placeholder="****">
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="flex justify-end gap-4">
        <a href="{{ url_for('superadmin.liste_entreprises') }}" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
            Annuler
        </a>
        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
            <i class="fas fa-save mr-2"></i> {% if entreprise %}Mettre à jour{% else %}Créer l'entreprise{% endif %}
        </button>
    </div>
</form>
{% endblock %}
