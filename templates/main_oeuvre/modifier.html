{% extends "base.html" %}

{% block page_title %}Modifier Ouvrier{% endblock %}
{% block page_subtitle %}{{ ouvrier.prenom }} {{ ouvrier.nom }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                <i class="fas fa-user-edit text-lg"></i>
            </div>
            <div>
                <h2 class="text-lg font-bold text-gray-900">Modification du profil</h2>
                <p class="text-xs text-gray-500">Mettez à jour les informations</p>
            </div>
        </div>

        <div class="p-6 md:p-8">
            <form method="POST" action="{{ url_for('main_oeuvre.modifier', id=ouvrier.id) }}" enctype="multipart/form-data" class="space-y-8">

                <!-- Photo Upload Section -->
                <div class="flex flex-col items-center justify-center mb-6">
                    <div class="relative group cursor-pointer">
                        <div class="w-32 h-32 bg-gray-50 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 overflow-hidden transition-all group-hover:border-primary-500 group-hover:bg-white shadow-inner">
                             {% if ouvrier.photo_profil %}
                            <img id="preview-image" src="{{ url_for('static', filename='uploads/' + ouvrier.photo_profil) }}" class="absolute inset-0 w-full h-full object-cover">
                            {% else %}
                            <div class="text-center space-y-1 group-hover:scale-105 transition-transform" id="placeholder-icon">
                                <i class="fas fa-camera text-gray-400 text-3xl group-hover:text-primary-500 transition-colors"></i>
                                <p class="text-xs text-gray-400 group-hover:text-primary-600 font-medium">Photo</p>
                            </div>
                            <img id="preview-image" src="#" alt="Aperçu" class="absolute inset-0 w-full h-full object-cover hidden">
                            {% endif %}
                        </div>
                        <div class="absolute bottom-0 right-0 bg-primary-600 text-white rounded-full p-2 shadow-lg transform translate-x-1 translate-y-1 group-hover:scale-110 transition-transform">
                            <i class="fas fa-pen text-xs"></i>
                        </div>
                        <input type="file" name="photo_profil" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer w-full h-full z-10" onchange="previewImage(this)">
                    </div>
                </div>

                <!-- Personal Info -->
                <div>
                    <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">Informations Personnelles</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="nom" class="block text-sm font-medium text-gray-700 mb-1">Nom <span class="text-red-500">*</span></label>
                            <input type="text" name="nom" id="nom" value="{{ ouvrier.nom }}" required class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm bg-gray-50 focus:bg-white transition-colors h-11">
                        </div>
                        <div>
                            <label for="prenom" class="block text-sm font-medium text-gray-700 mb-1">Prénom <span class="text-red-500">*</span></label>
                            <input type="text" name="prenom" id="prenom" value="{{ ouvrier.prenom }}" required class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm bg-gray-50 focus:bg-white transition-colors h-11">
                        </div>

                        <div class="md:col-span-2">
                             <label for="adresse" class="block text-sm font-medium text-gray-700 mb-1">Adresse</label>
                             <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <input type="text" name="adresse" id="adresse" value="{{ ouvrier.adresse or '' }}" class="block w-full pl-10 rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm h-11">
                             </div>
                        </div>

                        <div>
                            <label for="ville" class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                            <input type="text" name="ville" id="ville" value="{{ ouvrier.ville or '' }}" class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm h-11">
                        </div>
                        <div>
                            <label for="nationalite" class="block text-sm font-medium text-gray-700 mb-1">Nationalité</label>
                            <input type="text" name="nationalite" id="nationalite" value="{{ ouvrier.nationalite or '' }}" class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm h-11">
                        </div>

                        <div>
                            <label for="telephone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <input type="tel" name="telephone" id="telephone" value="{{ ouvrier.telephone or '' }}" class="block w-full pl-10 rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm h-11">
                            </div>
                        </div>

                        <div>
                            <label for="cni" class="block text-sm font-medium text-gray-700 mb-1">N° CNI / Passeport</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <input type="text" name="cni" id="cni" value="{{ ouvrier.cni or '' }}" placeholder="Ex: AB123456" class="block w-full pl-10 rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm uppercase h-11">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Info -->
                <div>
                    <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">Informations Professionnelles</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="poste" class="block text-sm font-medium text-gray-700 mb-1">Poste / Fonction</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <input type="text" name="poste" id="poste" value="{{ ouvrier.poste or '' }}" placeholder="Ex: Maçon" class="block w-full pl-10 rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm h-11">
                            </div>
                        </div>

                        <div>
                            <label for="taux_horaire" class="block text-sm font-medium text-gray-700 mb-1">Taux Horaire</label>
                            <div class="relative">
                                <input type="number" step="0.01" name="taux_horaire" id="taux_horaire" value="{{ ouvrier.taux_horaire }}" placeholder="0.00" class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm pr-12 font-mono font-bold text-right h-11">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500 font-medium bg-gray-50 rounded-r-xl border-l border-gray-300 px-3 h-11">
                                    MAD
                                </div>
                            </div>
                        </div>

                        <div class="md:col-span-2">
                             <label for="chantier_id" class="block text-sm font-medium text-gray-700 mb-1">Chantier d'affectation</label>
                             <select name="chantier_id" id="chantier_id" class="block w-full rounded-xl border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm bg-white h-11 text-gray-700">
                                <option value="">-- Aucun (Non assigné) --</option>
                                {% for c in chantiers %}
                                <option value="{{ c.id }}" {% if ouvrier.chantier_id == c.id %}selected{% endif %}>{{ c.nom }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Documents -->
                <div>
                     <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">Documents</h3>
                     {% if ouvrier.photo_cni %}
                     <div class="flex items-center gap-3 mb-4 p-3 bg-blue-50 border border-blue-100 rounded-lg">
                         <i class="fas fa-file-check text-blue-600"></i>
                         <div class="flex-1">
                             <p class="text-sm font-medium text-blue-900">Document existant</p>
                             <a href="{{ url_for('static', filename='uploads/' + ouvrier.photo_cni) }}" target="_blank" class="text-xs text-blue-600 hover:underline">Voir le fichier actuel</a>
                         </div>
                         <i class="fas fa-check-circle text-blue-500"></i>
                     </div>
                     {% endif %}

                     <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 hover:bg-gray-50 transition-colors text-center cursor-pointer relative">
                         <input type="file" name="photo_cni" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                         <i class="fas fa-file-image text-gray-400 text-3xl mb-2"></i>
                         <p class="text-sm font-medium text-gray-900">{% if ouvrier.photo_cni %}Remplacer le document{% else %}Ajouter une pièce d'identité{% endif %}</p>
                         <p class="text-xs text-gray-500 mt-1">Glissez le fichier ou cliquez pour parcourir</p>
                     </div>
                </div>

                <div class="flex items-center justify-end gap-3 pt-6 border-t border-gray-100">
                    <a href="{{ url_for('main_oeuvre.index') }}" class="px-6 py-2.5 text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-xl transition-all font-medium shadow-sm h-11 flex items-center">Annuler</a>
                    <button type="submit" class="px-6 py-2.5 bg-primary-600 text-white rounded-xl hover:bg-primary-700 shadow-lg shadow-primary-500/30 transition-all font-medium flex items-center gap-2 h-11">
                        <i class="fas fa-save"></i> Mettre à jour
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/main_oeuvre.js') }}"></script>
{% endblock %}
