{% extends "base.html" %}

{% block page_title %}Modifier Ouvrier{% endblock %}
{% block page_subtitle %}{{ ouvrier.prenom }} {{ ouvrier.nom }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8">
    <form method="POST" action="{{ url_for('main_oeuvre.modifier', id=ouvrier.id) }}" enctype="multipart/form-data" class="space-y-6">
        <!-- Photo de profil -->
        <div class="flex justify-center mb-6">
            <div class="space-y-2 text-center">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 mx-auto overflow-hidden relative group cursor-pointer">
                    {% if ouvrier.photo_profil %}
                    <img src="{{ url_for('static', filename='uploads/' + ouvrier.photo_profil) }}" class="w-full h-full object-cover">
                    {% else %}
                    <i class="fas fa-camera text-gray-400 text-2xl group-hover:text-primary-500"></i>
                    {% endif %}
                    <input type="file" name="photo_profil" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" title="Modifier la photo de profil">
                </div>
                <span class="text-xs text-gray-500">Photo de profil</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">Nom <span class="text-red-500">*</span></label>
                <input type="text" name="nom" id="nom" value="{{ ouvrier.nom }}" required class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
            </div>
            <div>
                <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">Prénom <span class="text-red-500">*</span></label>
                <input type="text" name="prenom" id="prenom" value="{{ ouvrier.prenom }}" required class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="md:col-span-2">
                <label for="adresse" class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                <input type="text" name="adresse" id="adresse" value="{{ ouvrier.adresse or '' }}" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
            </div>
            <div>
                <label for="ville" class="block text-sm font-medium text-gray-700 mb-2">Ville</label>
                <input type="text" name="ville" id="ville" value="{{ ouvrier.ville or '' }}" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="nationalite" class="block text-sm font-medium text-gray-700 mb-2">Nationalité</label>
                <input type="text" name="nationalite" id="nationalite" value="{{ ouvrier.nationalite or '' }}" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
            </div>
            <div>
                <label for="chantier_id" class="block text-sm font-medium text-gray-700 mb-2">Chantier d'affectation</label>
                <select name="chantier_id" id="chantier_id" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
                    <option value="">-- Aucun (Non assigné) --</option>
                    {% for c in chantiers %}
                    <option value="{{ c.id }}" {% if ouvrier.chantier_id == c.id %}selected{% endif %}>{{ c.nom }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div>
            <label for="poste" class="block text-sm font-medium text-gray-700 mb-2">Poste / Fonction</label>
            <input type="text" name="poste" id="poste" value="{{ ouvrier.poste or '' }}" placeholder="Ex: Maçon, Chef d'équipe..." class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
        </div>

        <div>
            <label for="telephone" class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
            <input type="tel" name="telephone" id="telephone" value="{{ ouvrier.telephone or '' }}" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
        </div>

        <div>
            <label for="cni" class="block text-sm font-medium text-gray-700 mb-2">N° CNI / Passeport / Séjour</label>
            <input type="text" name="cni" id="cni" value="{{ ouvrier.cni or '' }}" placeholder="Ex: AB123456" class="w-full rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Photo Pièce d'Identité</label>
            {% if ouvrier.photo_cni %}
            <div class="mb-2">
                <a href="{{ url_for('static', filename='uploads/' + ouvrier.photo_cni) }}" target="_blank" class="text-primary-600 hover:underline text-sm flex items-center gap-1">
                    <i class="fas fa-image"></i> Voir la pièce actuelle
                </a>
            </div>
            {% endif %}
            <input type="file" name="photo_cni" accept="image/*" class="block w-full text-sm text-gray-500
                file:mr-4 file:py-2 file:px-4
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-primary-50 file:text-primary-700
                hover:file:bg-primary-100
            ">
        </div>

        <div>
            <label for="taux_horaire" class="block text-sm font-medium text-gray-700 mb-2">Taux Horaire (MAD)</label>
            <div class="relative">
                <input type="number" step="0.01" name="taux_horaire" id="taux_horaire" value="{{ ouvrier.taux_horaire }}" placeholder="0.00" class="w-full pl-4 pr-12 rounded-lg border-gray-300 focus:border-primary-500 focus:ring-primary-500 transition-colors shadow-sm">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                    MAD
                </div>
            </div>
        </div>

        <div class="flex items-center justify-end gap-3 pt-6 border-t border-gray-100 mt-8">
            <a href="{{ url_for('main_oeuvre.index') }}" class="px-4 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors font-medium">Annuler</a>
            <button type="submit" class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 shadow-sm transition-colors font-medium">Enregistrer</button>
        </div>
    </form>
</div>
{% endblock %}
